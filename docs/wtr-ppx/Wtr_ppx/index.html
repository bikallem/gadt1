<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Wtr_ppx (wtr-ppx.Wtr_ppx)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 244b5317d"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">wtr-ppx</a> &#x00BB; Wtr_ppx</nav><header class="odoc-preamble"><h1>Module <code><span>Wtr_ppx</span></code></h1></header><nav class="odoc-toc"><ul><li><a href="#wtr-ppx">Wtr ppx</a><ul><li><a href="#custom-decoder">Custom Decoder</a></li><li><a href="#route-handlers">Route Handlers</a></li></ul></li></ul></nav><div class="odoc-content"><h2 id="wtr-ppx"><a href="#wtr-ppx" class="anchor"></a>Wtr ppx</h2><p>Specifying a Route in a <code>%wtr</code> ppx follows the following syntax:</p><ul><li><code>wtr syntax = http methods separated by comma ';' http uri</code></li><li><code>uri syntax = http uri</code></li><li><code>http uri = HTTP request path syntax</code></li><li><code>http uri = HTTP request path syntax ? request query</code></li></ul><p>A URI in a <code>%wtr</code> ppx is syntactically and sematically a HTTP URI with the addition of decoders and some some useful additions listed below:</p><ul><li>The default HTTP method if none is specified is GET method.</li><li><b>Full splat <code>**</code></b> - Full spat operator matches any/all path following a full splat. For example <code>/home/**</code> matches the following uri paths, <code>/home/about/, home/contact, /home/product</code> etc. Full splat must be the last component of an uri. It is an error to specify other uri path component after full splat operator. Additionally <code>wtr</code> decodes the remaining matched url in the route handler. For example,</li></ul><pre><code>let r =
  Wtr.t [{%wtr|get; /public/** |} (fun url -&gt; Format.sprintf &quot;%s&quot; url)]
in
let s = Wtr.match' `GET &quot;/public/css/style.css&quot; in
s = Some &quot;css/style.css&quot;</code></pre><ul><li><b>Wildward <code>*</code></b> - A wildcard operator matches any text appearing on the path component position. For example, uri <code>/home/*/page1</code> matches the following <code>/home/23/page1, /home/true/page1, /home/234.4/page1</code> etc. The semantics of wildcard operator is the same as using <code>:string</code> decoder in a uri, i.e. it affects the route handler function signature.</li><li><b>Trailing slash <code>/</code></b> - A trailing slash ensures that Wtr will match a trailing <code>/</code> in a uri. For example, uri <code>/home/about/</code> matches <code>/home/about/</code> but not <code>/home/about</code>.</li></ul><h3 id="custom-decoder"><a href="#custom-decoder" class="anchor"></a>Custom Decoder</h3><p>The convention for creating a custom decoder that can be used in wtr ppxes are as follows:</p><ol><li>Encapsulated in a module</li><li>The module defines a type called `t`</li><li>The module defines a value called <code>t</code> which is of type <code>t Wtr.decoder</code>.</li></ol><p>As an example, we define a custom decoder called <code>Fruit</code> and use it in wtr ppxes:</p><pre>      module Fruit = struct
        type t = Apple | Orange | Pineapple

        let t : t Wtr.decoder =
          Wtr.decoder ~name:&quot;fruit&quot; ~decode:(function
            | &quot;apple&quot; -&gt; Some Apple
            | &quot;orange&quot; -&gt; Some Orange
            | &quot;pineapple&quot; -&gt; Some Pineapple
            | _ -&gt; None )
      end</pre><p>The custom decoder thus defined can then can be used in <code>%wtr</code> ppx as follows:</p><pre>[%wtr &quot;get; /fruit/:Fruit&quot;] fruit_page</pre><p>Note the name following the colon <code>:</code> must match the name of the module, i.e. <code>:Fruit</code> in the above example.</p><h3 id="route-handlers"><a href="#route-handlers" class="anchor"></a>Route Handlers</h3><p>Route handlers are functions that accepts the decoded data from URI. A HTTP method, a URI and a route handler makes a <code>route</code>. The use of decoders \- both built-in and custom - affect the function signature of a route handler. For e.g.</p><ul><li>A uri spec <code>/home/:int/:bool</code> expects a route handler as <code>fun (i:int) (b:bool) -&gt; ....</code></li></ul><ul><li>A uri spec <code>/home/:string</code> expects a route handler as <code>(fun (s:string) -&gt; ...)</code></li></ul></div></body></html>