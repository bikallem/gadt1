<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Wtr (wtr.Wtr)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 244b5317d"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">wtr</a> &#x00BB; Wtr</nav><header class="odoc-preamble"><h1>Module <code><span>Wtr</span></code></h1></header><nav class="odoc-toc"><ul><li><a href="#types">Types</a></li><li><a href="#uri">Specifying a URI</a></li><li><a href="#decoders">Decoders</a><ul><li><a href="#built-in-decoders">Built-in Decoders</a></li><li><a href="#custom-decoders">Custom Decoders</a></li></ul></li><li><a href="#route-handlers">Route Handlers</a></li><li><a href="#router">Router</a></li><li><a href="#http-method">HTTP Method</a></li><li><a href="#pp">Pretty Printers</a></li></ul></nav><div class="odoc-content"><h2 id="types"><a href="#types" class="anchor"></a>Types</h2><div class="odoc-spec"><div class="spec type" id="type-router" class="anchored"><a href="#type-router" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a router</span></span></code></div><div class="spec-doc"><p><code>'a t</code> represents a Trie based router.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-route" class="anchored"><a href="#type-route" class="anchor"></a><code><span><span class="keyword">and</span> <span>'c route</span></span></code></div><div class="spec-doc"><p><code>'c route</code> is a <code>uri</code> and its handler. <code>'c</code> represents the value returned by the handler.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-uri" class="anchored"><a href="#type-uri" class="anchor"></a><code><span><span class="keyword">and</span> <span>('a, 'b) uri</span></span></code></div><div class="spec-doc"><p><code>('a, 'b) uri</code> represents a route URI - both the path and query, e.g. <code>/home/about/,
    /home/contact, /home/contact?name=a&amp;no=123</code> etc. It is created via <code>%wtr</code> ppx</p></div></div><div class="odoc-spec"><div class="spec type" id="type-method'" class="anchored"><a href="#type-method'" class="anchor"></a><code><span><span class="keyword">and</span> method'</span><span> = </span><span>[ </span></code><table><tr id="type-method'.GET" class="anchored"><td class="def constructor"><a href="#type-method'.GET" class="anchor"></a><code><span>| </span></code><code><span>`GET</span></code></td></tr><tr id="type-method'.HEAD" class="anchored"><td class="def constructor"><a href="#type-method'.HEAD" class="anchor"></a><code><span>| </span></code><code><span>`HEAD</span></code></td></tr><tr id="type-method'.POST" class="anchored"><td class="def constructor"><a href="#type-method'.POST" class="anchor"></a><code><span>| </span></code><code><span>`POST</span></code></td></tr><tr id="type-method'.PUT" class="anchored"><td class="def constructor"><a href="#type-method'.PUT" class="anchor"></a><code><span>| </span></code><code><span>`PUT</span></code></td></tr><tr id="type-method'.DELETE" class="anchored"><td class="def constructor"><a href="#type-method'.DELETE" class="anchor"></a><code><span>| </span></code><code><span>`DELETE</span></code></td></tr><tr id="type-method'.CONNECT" class="anchored"><td class="def constructor"><a href="#type-method'.CONNECT" class="anchor"></a><code><span>| </span></code><code><span>`CONNECT</span></code></td></tr><tr id="type-method'.OPTIONS" class="anchored"><td class="def constructor"><a href="#type-method'.OPTIONS" class="anchor"></a><code><span>| </span></code><code><span>`OPTIONS</span></code></td></tr><tr id="type-method'.TRACE" class="anchored"><td class="def constructor"><a href="#type-method'.TRACE" class="anchor"></a><code><span>| </span></code><code><span>`TRACE</span></code></td></tr><tr id="type-method'.Method" class="anchored"><td class="def constructor"><a href="#type-method'.Method" class="anchor"></a><code><span>| </span></code><code><span>`Method <span class="keyword">of</span> string</span></code></td></tr></table><code><span> ]</span></code></div><div class="spec-doc"><p><code>method'</code> represents HTTP request methods. It can be used as part of a <a href="#type-uri"><code>uri</code></a> in <code>%wtr</code> ppx.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-decoder" class="anchored"><a href="#type-decoder" class="anchor"></a><code><span><span class="keyword">and</span> <span>'a decoder</span></span></code></div><div class="spec-doc"><p>Represents a uri component decoder, such as <code>:int, :float, :bool</code> etc.</p></div></div><h2 id="uri"><a href="#uri" class="anchor"></a>Specifying a URI</h2><p>Specifying a URI in a <code>%wtr</code> ppx follows the following syntax:</p><ul><li><code>wtr syntax = http methods separated by comma ';' http uri</code></li><li><code>uri syntax = http uri</code></li><li><code>http uri = HTTP request path syntax</code></li><li><code>http uri = HTTP request path syntax ? request query</code></li></ul><p>A URI in a <code>%wtr</code> ppx is syntactically and sematically a HTTP URI with the addition of decoders and some some useful additions listed below:</p><ul><li>The default HTTP method if none is specified is GET method.</li><li><b>Full splat <code>**</code></b> - Full spat operator matches any/all path following a full splat. For example <code>/home/**</code> matches the following uri paths, <code>/home/about/, home/contact, /home/product</code> etc. Full splat must be the last component of an uri. It is an error to specify other uri path component after full splat operator. Additionally <code>wtr</code> decodes the remaining matched url in the route handler. For example,</li></ul><pre><code>let r =
  Wtr.t [{%wtr|get; /public/** |} (fun url -&gt; Format.sprintf &quot;%s&quot; url)]
in
let s = Wtr.match' `GET &quot;/public/css/style.css&quot; in
s = Some &quot;css/style.css&quot;</code></pre><ul><li><b>Wildward <code>*</code></b> - A wildcard operator matches any text appearing on the path component position. For example, uri <code>/home/*/page1</code> matches the following <code>/home/23/page1, /home/true/page1, /home/234.4/page1</code> etc. The semantics of wildcard operator is the same as using <code>:string</code> decoder in a uri, i.e. it affects the route handler function signature.</li><li><b>Trailing slash <code>/</code></b> - A trailing slash ensures that Wtr will match a trailing <code>/</code> in a uri. For example, uri <code>/home/about/</code> matches <code>/home/about/</code> but not <code>/home/about</code>.</li></ul><h2 id="decoders"><a href="#decoders" class="anchor"></a>Decoders</h2><h3 id="built-in-decoders"><a href="#built-in-decoders" class="anchor"></a>Built-in Decoders</h3><p><code>Wtr</code> provides the following built in decoders that can be used as when specifying URI in <code>{%wtr| |}</code> ppx:</p><ul><li><code>:int</code> - decodes a <code>int</code></li><li><code>:int32</code> - decodes a <code>int32</code></li><li><code>:int64</code> - decodes a <code>int64</code></li><li><code>:float</code> - decodes a <code>float</code> or <code>int</code></li><li><code>:bool</code> - decodes a <code>bool</code></li><li><code>:string</code> - decodes a <code>string</code></li></ul><p>The built-in decoders can be used as follows:</p><p><code>{%wtr|get; /home/:int |}</code>, <code>{%wtr| /home/:bool |}</code></p><h3 id="custom-decoders"><a href="#custom-decoders" class="anchor"></a>Custom Decoders</h3><div class="odoc-spec"><div class="spec value" id="val-decoder" class="anchored"><a href="#val-decoder" class="anchor"></a><code><span><span class="keyword">val</span> decoder : <span>name:string <span class="arrow">&#45;&gt;</span></span> <span>decode:<span>(<span>string <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> option</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-decoder">decoder</a></span></span></code></div><div class="spec-doc"><p><code>decoder ~name ~decode</code> creates a user defined custom uri decoder component. <code>name</code> is used during the pretty printing of <code>uri</code>.</p></div></div><p>Wtr supports creating custom, user defined decoders. The convention for user defined decoders is as follows:</p><p>A custom decoder should be defined in a module which has the following:</p><ol><li>type called `t`</li><li>a value called <code>t</code> which is of type <code>t Wtr.decoder</code>.</li></ol><p>Custom decoder example,</p><pre><code>module Fruit = struct
  type t = Apple | Orange | Pineapple

  let t : t Wtr.decoder =
    Wtr.decoder ~name:&quot;fruit&quot; ~decode:(function
      | &quot;apple&quot; -&gt; Some Apple
      | &quot;orange&quot; -&gt; Some Orange
      | &quot;pineapple&quot; -&gt; Some Pineapple
      | _ -&gt; None )
end</code></pre><p>The custom decoder thus defined can then can be used in <code>%wtr</code> ppx as follows:</p><p><code>{%wtr| get ; /fruit/:Fruit  |} fruit_page</code></p><h2 id="route-handlers"><a href="#route-handlers" class="anchor"></a>Route Handlers</h2><p>Route handlers are functions that accepts the decoded data from URI. A HTTP method, a URI and a route handler makes a <a href="#type-route"><code>route</code></a>. The use of decoders \- both built-in and custom - affect the function signature of a route handler. For e.g.</p><ul><li>A uri spec <code>/home/:int/:bool</code> expects a route handler as <code>fun (i:int) (b:bool) -&gt; ....</code></li></ul><ul><li>A uri spec <code>/home/:string</code> expects a route handler as <code>(fun (s:string) -&gt; ...)</code></li></ul><h2 id="router"><a href="#router" class="anchor"></a>Router</h2><div class="odoc-spec"><div class="spec value" id="val-router" class="anchored"><a href="#val-router" class="anchor"></a><code><span><span class="keyword">val</span> router : <span><span><span><span><span class="type-var">'a</span> <a href="#type-route">route</a></span> list</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-router">router</a></span></span></code></div><div class="spec-doc"><p><code>route routes</code> is a router made up of given <code>routes</code>. It is used with <code>%wtr</code> ppx.</p><pre><code>Wtr.router [{%wtr| /public/**|}] </code></pre></div></div><div class="odoc-spec"><div class="spec value" id="val-match'" class="anchored"><a href="#val-match'" class="anchor"></a><code><span><span class="keyword">val</span> match' : <span><a href="#type-method'">method'</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-router">router</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> option</span></span></code></div><div class="spec-doc"><p><code>match' method' request_target router</code> is <code>Some a</code> if <code>method'</code> and <code>request_target</code> together matches one of the routes defined in <code>router</code>. Otherwise it is None.</p></div></div><h2 id="http-method"><a href="#http-method" class="anchor"></a>HTTP Method</h2><div class="odoc-spec"><div class="spec value" id="val-method_equal" class="anchored"><a href="#val-method_equal" class="anchor"></a><code><span><span class="keyword">val</span> method_equal : <span><a href="#type-method'">method'</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-method'">method'</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-method'" class="anchored"><a href="#val-method'" class="anchor"></a><code><span><span class="keyword">val</span> method' : <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-method'">method'</a></span></code></div></div><h2 id="pp"><a href="#pp" class="anchor"></a>Pretty Printers</h2><div class="odoc-spec"><div class="spec value" id="val-pp" class="anchored"><a href="#val-pp" class="anchor"></a><code><span><span class="keyword">val</span> pp : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-router">router</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-pp_method" class="anchored"><a href="#val-pp_method" class="anchor"></a><code><span><span class="keyword">val</span> pp_method : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-method'">method'</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-pp_route" class="anchored"><a href="#val-pp_route" class="anchor"></a><code><span><span class="keyword">val</span> pp_route : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> <a href="#type-route">route</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div></div></body></html>