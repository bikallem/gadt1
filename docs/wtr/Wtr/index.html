<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Wtr (wtr.Wtr)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.0-beta4-59-g244b5317d"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">wtr</a> &#x00BB; Wtr</nav><header class="odoc-preamble"><h1>Module <code><span>Wtr</span></code></h1></header><nav class="odoc-toc"><ul><li><a href="#types">Types</a></li><li><a href="#router">Router</a></li><li><a href="#decoders">Decoders</a></li><li><a href="#http-method">HTTP Method</a></li><li><a href="#pretty-printers">Pretty Printers</a></li></ul></nav><div class="odoc-content"><h2 id="types"><a href="#types" class="anchor"></a>Types</h2><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a t</span></span></code></div><div class="spec-doc"><p><code>'a t</code> represents a Trie based router.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-route" class="anchored"><a href="#type-route" class="anchor"></a><code><span><span class="keyword">and</span> <span>'c route</span></span></code></div><div class="spec-doc"><p><code>'c route</code> is a <code>uri</code> and its handler. <code>'c</code> represents the value returned by the handler.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-uri" class="anchored"><a href="#type-uri" class="anchor"></a><code><span><span class="keyword">and</span> <span>('a, 'b) uri</span></span></code></div><div class="spec-doc"><p><code>('a, 'b) uri</code> represents a route URI - both the path and query, e.g. <code>/home/about/,
    /home/contact, /home/contact?name=a&amp;no=123</code> etc.</p><p>A uri is created via <code>%wtr</code> ppx.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-method'" class="anchored"><a href="#type-method'" class="anchor"></a><code><span><span class="keyword">and</span> method'</span><span> = </span><span>[ </span></code><table><tr id="type-method'.GET" class="anchored"><td class="def constructor"><a href="#type-method'.GET" class="anchor"></a><code><span>| </span></code><code><span>`GET</span></code></td></tr><tr id="type-method'.HEAD" class="anchored"><td class="def constructor"><a href="#type-method'.HEAD" class="anchor"></a><code><span>| </span></code><code><span>`HEAD</span></code></td></tr><tr id="type-method'.POST" class="anchored"><td class="def constructor"><a href="#type-method'.POST" class="anchor"></a><code><span>| </span></code><code><span>`POST</span></code></td></tr><tr id="type-method'.PUT" class="anchored"><td class="def constructor"><a href="#type-method'.PUT" class="anchor"></a><code><span>| </span></code><code><span>`PUT</span></code></td></tr><tr id="type-method'.DELETE" class="anchored"><td class="def constructor"><a href="#type-method'.DELETE" class="anchor"></a><code><span>| </span></code><code><span>`DELETE</span></code></td></tr><tr id="type-method'.CONNECT" class="anchored"><td class="def constructor"><a href="#type-method'.CONNECT" class="anchor"></a><code><span>| </span></code><code><span>`CONNECT</span></code></td></tr><tr id="type-method'.OPTIONS" class="anchored"><td class="def constructor"><a href="#type-method'.OPTIONS" class="anchor"></a><code><span>| </span></code><code><span>`OPTIONS</span></code></td></tr><tr id="type-method'.TRACE" class="anchored"><td class="def constructor"><a href="#type-method'.TRACE" class="anchor"></a><code><span>| </span></code><code><span>`TRACE</span></code></td></tr><tr id="type-method'.Method" class="anchored"><td class="def constructor"><a href="#type-method'.Method" class="anchor"></a><code><span>| </span></code><code><span>`Method <span class="keyword">of</span> string</span></code></td></tr></table><code><span> ]</span></code></div><div class="spec-doc"><p><code>method'</code> represents HTTP request methods. It can be used as part of a <a href="#type-uri"><code>uri</code></a> in <code>%wtr</code> ppx.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-decoder" class="anchored"><a href="#type-decoder" class="anchor"></a><code><span><span class="keyword">and</span> <span>'a decoder</span></span></code></div><div class="spec-doc"><p>Represents a uri component decoder, such as <code>:int, :float, :bool</code> etc.</p></div></div><h2 id="router"><a href="#router" class="anchor"></a>Router</h2><div class="odoc-spec"><div class="spec value" id="val-create" class="anchored"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : <span><span><span><span><span class="type-var">'a</span> <a href="#type-route">route</a></span> list</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>create routes</code> creates a router from a list of <code>route</code>s. Values of <code>routes</code> are created by <code>%wtr</code> ppx.</p><pre><code>module Fruit = struct
  type t = Apple | Orange | Pineapple

  let t : t Wtr.decoder =
    Wtr.create_decoder ~name:&quot;fruit&quot; ~decode:(function
      | &quot;apple&quot; -&gt; Some Apple
      | &quot;orange&quot; -&gt; Some Orange
      | &quot;pineapple&quot; -&gt; Some Pineapple
      | _ -&gt; None )
end

let prod_page i = &quot;Int page. number : &quot; ^ string_of_int i
let float_page f = &quot;Float page. number : &quot; ^ string_of_float f
let contact_page nm num = &quot;Contact. Hi, &quot; ^ nm ^ &quot;. Num &quot; ^ string_of_int num
let product1 name id q = Format.sprintf &quot;Product1 %s. Id: %d. q = %b&quot; name id q
let product2 name id = Format.sprintf &quot;Product2 %s. Id: %d.&quot; name id

let fruit_page = function
  | Fruit.Apple -&gt; &quot;Apples are juicy!&quot;
  | Orange -&gt; &quot;Orange is a citrus fruit.&quot;
  | Pineapple -&gt; &quot;Pineapple has scaly skin&quot;

let faq category_id =
  let category_name =
    match category_id with
    | 1 -&gt; &quot;products&quot;
    | 2 -&gt; &quot;insurance&quot;
    | 3 -&gt; &quot;returns&quot;
    | _ -&gt; &quot;unknown&quot;
  in
  &quot;FAQ page for category : &quot; ^ category_name

let router =
  Wtr.(
    create
      [ {%wtr\| get,post,head,delete  ; /home/about/:int   \|} (fun _ -&gt;
            &quot;about page&quot; )
      ; {%wtr\| get                   ; /home/:int/        \|} prod_page
      ; {%wtr\| get,post              ; /home/:float/      \|} float_page
      ; {%wtr\| /contact/*/:int                            \|} contact_page
      ; {%wtr\| /product/:string?section=:int&amp;q=:bool      \|} product1
      ; {%wtr\| /product/:string?section=:int&amp;q1=yes       \|} product2
      ; {%wtr\| /fruit/:Fruit                              \|} fruit_page
      ; {%wtr\| /faq/:int/**                               \|} faq ])</code></pre></div></div><div class="odoc-spec"><div class="spec value" id="val-match'" class="anchored"><a href="#val-match'" class="anchor"></a><code><span><span class="keyword">val</span> match' : <span><a href="#type-method'">method'</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> option</span></span></code></div><div class="spec-doc"><p><code>match method' uri t </code> matches a route to a given <code>uri</code>, executes its handler and returns the computed value. <code>None</code> is returned if <code>uri</code> is not matched.</p></div></div><h2 id="decoders"><a href="#decoders" class="anchor"></a>Decoders</h2><p><code>Wtr</code> provides the following built in decoders that can be used in <code>{%wtr\|\|}</code> ppx:</p><ul><li><code>:int</code></li><li><code>:int32</code></li><li><code>:int64</code></li><li><code>:float</code></li><li><code>:bool</code></li><li><code>:string</code></li></ul><p>e.g. <code>{%wtr\| /home/:int \|}</code>, <code>{%wtr\|/home/:bool\|}</code>.</p><p>Additionally creating custom, user defined decoder is also supported. The convention for user defined decoders is as follows:</p><p>It should be defined in a module. The module should define a type called <code>t</code> and a value called <code>t</code> which returns <code>t Wtr.decoder</code>.</p><p>For e.g.</p><pre><code>module Fruit = struct
  type t = Apple | Orange | Pineapple

  let t : t Wtr.decoder =
    Wtr.create_decoder ~name:&quot;fruit&quot; ~decode:(function
      | &quot;apple&quot; -&gt; Some Apple
      | &quot;orange&quot; -&gt; Some Orange
      | &quot;pineapple&quot; -&gt; Some Pineapple
      | _ -&gt; None )
end</code></pre><div class="odoc-spec"><div class="spec value" id="val-create_decoder" class="anchored"><a href="#val-create_decoder" class="anchor"></a><code><span><span class="keyword">val</span> create_decoder : <span>name:string <span class="arrow">&#45;&gt;</span></span> <span>decode:<span>(<span>string <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> option</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-decoder">decoder</a></span></span></code></div><div class="spec-doc"><p><code>create_decoder ~name ~decode</code> creates a user defined decoder uri component. <code>name</code> is used during the pretty printing of <code>uri</code>.</p></div></div><h2 id="http-method"><a href="#http-method" class="anchor"></a>HTTP Method</h2><div class="odoc-spec"><div class="spec value" id="val-method_equal" class="anchored"><a href="#val-method_equal" class="anchor"></a><code><span><span class="keyword">val</span> method_equal : <span><a href="#type-method'">method'</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-method'">method'</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-method'" class="anchored"><a href="#val-method'" class="anchor"></a><code><span><span class="keyword">val</span> method' : <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-method'">method'</a></span></code></div><div class="spec-doc"><p><code>method' m</code> creates a <a href="#type-method'"><code>method'</code></a> from value <code>m</code>.</p></div></div><h2 id="pretty-printers"><a href="#pretty-printers" class="anchor"></a>Pretty Printers</h2><div class="odoc-spec"><div class="spec value" id="val-pp_method'" class="anchored"><a href="#val-pp_method'" class="anchor"></a><code><span><span class="keyword">val</span> pp_method' : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-method'">method'</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-pp_route" class="anchored"><a href="#val-pp_route" class="anchor"></a><code><span><span class="keyword">val</span> pp_route : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> <a href="#type-route">route</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-pp" class="anchored"><a href="#val-pp" class="anchor"></a><code><span><span class="keyword">val</span> pp : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div></div></body></html>